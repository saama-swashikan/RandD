
podTemplate(
  containers: [
    containerTemplate(
      name: 'swashikan', 
      image: '791532114280.dkr.ecr.us-east-1.amazonaws.com/swashikan:lsacone',
      command: 'cat',
      ttyEnabled: true,
      resourceLimitEphemeralStorage: '10Gi',
      resourceLimitMemory: '2Gi'
    )
  ],
  volumes: [
    dynamicPVC(requestsSize : '200Gi', mountPath: '/home/node/data')
  ]
) 

{
  node(POD_LABEL) {
    stage('Run plan'){
      container('swashikan'){
        script {
            withCredentials([[
                $class: 'AmazonWebServicesCredentialsBinding',
                credentialsId: "aws_sqdsam_jenkins",
                accessKeyVariable: 'AWS_ACCESS_KEY_ID',
                secretKeyVariable: 'AWS_SECRET_ACCESS_KEY'
            ],[
              $class: 'SSHUserPrivateKeyBinding',
              credentialsId: "jenkins_github_ssh_key",
              usernameVariable: "username",
              keyFileVariable: "ssh_key",
              passphraseVariable: "passphrase",

            ]]) {
                                    sh '''
                                        export pda_service=${PDA_SERVICE}
                                        export lsac_oauth_endpoint=${LSAC_OAUTH_ENDPOINT}  
                                        export lsac_app_client_id=${lsac_app_client_id}  
                                        export lsac_app_client_secret=${lsac_app_client_secret}  
                                        export primary_account_name=${primary_account_name}

                                        echo $pda_service
                                        echo $lsac_oauth_endpoint
                                        echo $lsac_app_client_id
                                        echo $lsac_app_client_secret
                                        echo $primary_account_name
                                    '''
                  
          }
      }
    }
  }
}
}
